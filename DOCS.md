# DOC_GUIDELINES — как писать рабочие концептуальные документы

## 0. Контекст

Конфигурация работы всегда одна и та же:

- Я — **постановщик задач / продакт**.
- Кодовый агент в IDE — **исполнитель**.
- Все действия в системе происходят через:
  - изменение файлов;
  - изменение конфигов;
  - изменение промптов;
  - изменение параметров вызовов.

**Цель любого концептуального документа** —  
описать *что именно* нужно менять в системе и *как именно* это влияет на поведение,  
так, чтобы из документа можно было напрямую получить команды для кодового агента.

Документ ≠ презентация.  
Документ = **спецификация артефактов и команд**.

---

## 1. Базовый принцип

Любой смысл в документе должен удовлетворять трём условиям:

1. **Есть конкретный артефакт**  
   (файл, конфиг, промпт, параметр), который можно найти в репо/проекте.

2. **Есть конкретное действие**  
   (что в этом артефакте меняем: поле, секцию, инструкцию, значение).

3. **Есть понятный эффект и метрика**  
   (что должно измениться в поведении системы, по какой метрике это видно).

Если какой-то абзац нельзя перевести в команду вида:

> «Найди артефакт X. В нём измени Y с A на B, ожидаемый эффект Z»,

— этот абзац либо выкинуть, либо переписать.

---

## 2. Что запрещено

В документах **нельзя**:

1. **Корпоративный язык**  
   - «заложить ресурсы»,  
   - «выстроить процесс»,  
   - «внедрить best practices»,  
   - «выравнивание стейкхолдеров»,  
   - «roadmap, стратегия, видение» — без привязки к файлам/параметрам.

2. **Пустые метафоры**  
   - «архитектурный потолок»,  
   - «память как библиотека»,  
   - «векторная карта знаний» — если из этого нельзя вывести конкретный параметр.

3. **Непроверяемые обобщения**  
   - «система должна лучше понимать пользователя»,  
   - «уменьшить уровень хаоса»,  
   - «сделать интерфейс дружелюбнее»  
   без указания, какие поля/промпты/конфиги правим и какую метрику смотрим.

4. **Рекомендации без рычага**  
   - «улучшить retrieval»,  
   - «сделать тегирование умнее»  
   — без указания: в *каком* файле *что* поменять.

Если формулировка звучит как текст для презентации менеджменту — скорее всего, она здесь не нужна.

---

## 3. Структура любого концептуального документа

Рекомендуемая структура (минимальная):

1. **0. Определение ключевого термина**  
   - Кратко, в 1–3 строках.  
   - Сразу в рабочих терминах: через артефакты и действия.  
   - Пример:  
     > Импакт-фактор — это конкретный артефакт (файл/конфиг/промпт), который я могу изменить, и это изменение заметно влияет на поведение системы.

2. **1. Список импакт-факторов (или сущностей)**  
   - Просто перечень по убыванию важности.  
   - Без воды, только имена.

3. **2. Для каждого импакт-фактора — одна и та же форма**  
   Шаблон секции (см. ниже).

4. **3. Сводка приоритетов**  
   - Короткий список: что трогаем первым, что вторым и т.д.

5. **4. (Опционально) Чеклист для кодового агента**  
   - Список команд-скелетов, которые можно копировать и доопределять.

---

## 4. Шаблон описания одного импакт-фактора

Каждый фактор описывается по одной и той же форме.

### 4.X. Название фактора (кратко и технически)

**4.X.1. Артефакт**

- Тип: файл / конфиг / промпт / параметр.
- Пример имени / пути:
  - `config/retrieval.json`
  - `prompts/archivist_system_prompt.md`
  - `llm_config.yaml: default_model`

Важно: имя не обязательно абсолютно точное, но **должно быть достаточно конкретным**, чтобы кодовый агент мог по тексту найти артефакт через поиск.

---

**4.X.2. Что в нём реально меняется**

Здесь описываются **конкретные поля/секции**, которые являются рычагами:

- Параметр: `strategy`, значения: `tags | semantic | hybrid`.
- Параметр: `top_k`, целое число.
- Секция: `# Правила тегирования предпочтений`.

Формат: короткий список:

- `field_name` / название секции;
- допустимые значения / тип;
- кратко — что означает.

---

**4.X.3. Механизм влияния**

Коротко, без метафор:

- «Определяет, какие записи попадают в выборку перед ранжированием».
- «Управляет тем, когда ассистент имеет право говорить “не знаю”».
- «Определяет, сколько памяти поместится в один запрос».

Задача — связать *изменение поля* с *изменением поведения*, без лирики.

---

**4.X.4. Метрики и симптомы**

- Какие метрики смотреть:
  - `retrieval_precision`,  
  - доля ответов “нет данных”,  
  - доля жалоб «он приписывает мне то, чего я не говорил» и т.п.
- Какие симптомы в живой работе укажут, что с этим фактором проблема.

Формат: краткий список.

---

**4.X.5. Примеры команд для кодового агента**

Самое важное место.

Несколько примеров в явном формате, как ты обычно говоришь агенту:

- «Найди конфигурационный файл, где описана стратегия retrieval. Добавь туда поле `strategy` со значением `hybrid`, если его нет. Если есть — измени значение на `hybrid`. Объясни, какие поля ещё завязаны на этот параметр».
- «Найди system prompt для ассистента, который отвечает пользователю. Добавь в него явное правило: не придумывать факты о пользователе, если их нет в памяти, и в таких случаях писать “нет данных в памяти”».

Если команду нельзя так сформулировать — значит, описание фактора слишком абстрактно.

---

## 5. Общие правила языка

1. **Писать на языке артефактов, а не ощущений**

   Вместо:
   - «Сделать систему более чувствительной к контексту пользователя»  
   писать:
   - «В промпте ассистента добавить правило: всегда использовать поднятые записи памяти перед обращением к общим знаниям модели».

2. **Минимум прилагательных, максимум существительных и глаголов действий**

   Плохо:
   - «умный, гибкий, устойчивый retrieval».

   Хорошо:
   - «retrieval с двумя источниками: `tags` + `semantic`, объединёнными в общий список, отсортированный по score».

3. **Никаких “мы должны”, только “что меняем”**

   Плохо:
   - «Мы должны улучшить тегирование».

   Хорошо:
   - «В `archivist_system_prompt.md` добавить правило: при записи пользовательских предпочтений обязательно добавлять тег `user_preference` + конкретную сущность (язык, инструмент и т.п.)».

4. **Короткие абзацы, максимум 3–4 строки**

   Если абзац нельзя за 10 секунд проглотить глазами — его нужно дробить или выкидывать.

---

## 6. Мини-шаблон для нового концептуального документа

Любой новый документ можно начинать так:

```markdown
# NAME_OF_DOC — кратко о чём документ

## 0. Определение ключевого термина

Ключевой термин: X.

Рабочее определение:
X — это <описание через артефакты и действия>.

## 1. Список импакт-факторов / сущностей

1. ...
2. ...
3. ...

## 2. Описание факторов

### 2.1. <Название фактора>

**Артефакт:**  
- Тип:  
- Пример пути:  

**Что меняем:**  
- ...

**Механизм влияния:**  
- ...

**Метрики/симптомы:**  
- ...

**Примеры команд для кодового агента:**  
- ...

### 2.2. <Следующий фактор>
...

Сделаю общую инструкцию в формате .md.
Это не «как красиво писать», а **как писать так, чтобы кодовый агент мог действовать**.

````markdown
# DOC_GUIDELINES — как писать рабочие концептуальные документы

## 0. Контекст

Конфигурация работы всегда одна и та же:

- Я — **постановщик задач / продакт**.
- Кодовый агент в IDE — **исполнитель**.
- Все действия в системе происходят через:
  - изменение файлов;
  - изменение конфигов;
  - изменение промптов;
  - изменение параметров вызовов.

**Цель любого концептуального документа** —  
описать *что именно* нужно менять в системе и *как именно* это влияет на поведение,  
так, чтобы из документа можно было напрямую получить команды для кодового агента.

Документ ≠ презентация.  
Документ = **спецификация артефактов и команд**.

---

## 1. Базовый принцип

Любой смысл в документе должен удовлетворять трём условиям:

1. **Есть конкретный артефакт**  
   (файл, конфиг, промпт, параметр), который можно найти в репо/проекте.

2. **Есть конкретное действие**  
   (что в этом артефакте меняем: поле, секцию, инструкцию, значение).

3. **Есть понятный эффект и метрика**  
   (что должно измениться в поведении системы, по какой метрике это видно).

Если какой-то абзац нельзя перевести в команду вида:

> «Найди артефакт X. В нём измени Y с A на B, ожидаемый эффект Z»,

— этот абзац либо выкинуть, либо переписать.

---

## 2. Что запрещено

В документах **нельзя**:

1. **Корпоративный язык**  
   - «заложить ресурсы»,  
   - «выстроить процесс»,  
   - «внедрить best practices»,  
   - «выравнивание стейкхолдеров»,  
   - «roadmap, стратегия, видение» — без привязки к файлам/параметрам.

2. **Пустые метафоры**  
   - «архитектурный потолок»,  
   - «память как библиотека»,  
   - «векторная карта знаний» — если из этого нельзя вывести конкретный параметр.

3. **Непроверяемые обобщения**  
   - «система должна лучше понимать пользователя»,  
   - «уменьшить уровень хаоса»,  
   - «сделать интерфейс дружелюбнее»  
   без указания, какие поля/промпты/конфиги правим и какую метрику смотрим.

4. **Рекомендации без рычага**  
   - «улучшить retrieval»,  
   - «сделать тегирование умнее»  
   — без указания: в *каком* файле *что* поменять.

Если формулировка звучит как текст для презентации менеджменту — скорее всего, она здесь не нужна.

---

## 3. Структура любого концептуального документа

Рекомендуемая структура (минимальная):

1. **0. Определение ключевого термина**  
   - Кратко, в 1–3 строках.  
   - Сразу в рабочих терминах: через артефакты и действия.  
   - Пример:  
     > Импакт-фактор — это конкретный артефакт (файл/конфиг/промпт), который я могу изменить, и это изменение заметно влияет на поведение системы.

2. **1. Список импакт-факторов (или сущностей)**  
   - Просто перечень по убыванию важности.  
   - Без воды, только имена.

3. **2. Для каждого импакт-фактора — одна и та же форма**  
   Шаблон секции (см. ниже).

4. **3. Сводка приоритетов**  
   - Короткий список: что трогаем первым, что вторым и т.д.

5. **4. (Опционально) Чеклист для кодового агента**  
   - Список команд-скелетов, которые можно копировать и доопределять.

---

## 4. Шаблон описания одного импакт-фактора

Каждый фактор описывается по одной и той же форме.

### 4.X. Название фактора (кратко и технически)

**4.X.1. Артефакт**

- Тип: файл / конфиг / промпт / параметр.
- Пример имени / пути:
  - `config/retrieval.json`
  - `prompts/archivist_system_prompt.md`
  - `llm_config.yaml: default_model`

Важно: имя не обязательно абсолютно точное, но **должно быть достаточно конкретным**, чтобы кодовый агент мог по тексту найти артефакт через поиск.

---

**4.X.2. Что в нём реально меняется**

Здесь описываются **конкретные поля/секции**, которые являются рычагами:

- Параметр: `strategy`, значения: `tags | semantic | hybrid`.
- Параметр: `top_k`, целое число.
- Секция: `# Правила тегирования предпочтений`.

Формат: короткий список:

- `field_name` / название секции;
- допустимые значения / тип;
- кратко — что означает.

---

**4.X.3. Механизм влияния**

Коротко, без метафор:

- «Определяет, какие записи попадают в выборку перед ранжированием».
- «Управляет тем, когда ассистент имеет право говорить “не знаю”».
- «Определяет, сколько памяти поместится в один запрос».

Задача — связать *изменение поля* с *изменением поведения*, без лирики.

---

**4.X.4. Метрики и симптомы**

- Какие метрики смотреть:
  - `retrieval_precision`,  
  - доля ответов “нет данных”,  
  - доля жалоб «он приписывает мне то, чего я не говорил» и т.п.
- Какие симптомы в живой работе укажут, что с этим фактором проблема.

Формат: краткий список.

---

**4.X.5. Примеры команд для кодового агента**

Самое важное место.

Несколько примеров в явном формате, как ты обычно говоришь агенту:

- «Найди конфигурационный файл, где описана стратегия retrieval. Добавь туда поле `strategy` со значением `hybrid`, если его нет. Если есть — измени значение на `hybrid`. Объясни, какие поля ещё завязаны на этот параметр».
- «Найди system prompt для ассистента, который отвечает пользователю. Добавь в него явное правило: не придумывать факты о пользователе, если их нет в памяти, и в таких случаях писать “нет данных в памяти”».

Если команду нельзя так сформулировать — значит, описание фактора слишком абстрактно.

---

## 5. Общие правила языка

1. **Писать на языке артефактов, а не ощущений**

   Вместо:
   - «Сделать систему более чувствительной к контексту пользователя»  
   писать:
   - «В промпте ассистента добавить правило: всегда использовать поднятые записи памяти перед обращением к общим знаниям модели».

2. **Минимум прилагательных, максимум существительных и глаголов действий**

   Плохо:
   - «умный, гибкий, устойчивый retrieval».

   Хорошо:
   - «retrieval с двумя источниками: `tags` + `semantic`, объединёнными в общий список, отсортированный по score».

3. **Никаких “мы должны”, только “что меняем”**

   Плохо:
   - «Мы должны улучшить тегирование».

   Хорошо:
   - «В `archivist_system_prompt.md` добавить правило: при записи пользовательских предпочтений обязательно добавлять тег `user_preference` + конкретную сущность (язык, инструмент и т.п.)».

4. **Короткие абзацы, максимум 3–4 строки**

   Если абзац нельзя за 10 секунд проглотить глазами — его нужно дробить или выкидывать.

---

## 6. Мини-шаблон для нового концептуального документа

Любой новый документ можно начинать так:

```markdown
# NAME_OF_DOC — кратко о чём документ

## 0. Определение ключевого термина

Ключевой термин: X.

Рабочее определение:
X — это <описание через артефакты и действия>.

## 1. Список импакт-факторов / сущностей

1. ...
2. ...
3. ...

## 2. Описание факторов

### 2.1. <Название фактора>

**Артефакт:**  
- Тип:  
- Пример пути:  

**Что меняем:**  
- ...

**Механизм влияния:**  
- ...

**Метрики/симптомы:**  
- ...

**Примеры команд для кодового агента:**  
- ...

### 2.2. <Следующий фактор>
...
````

---

## 7. Чеклист перед тем, как считать документ годным

Перед тем как считать документ готовым, задать себе 5 вопросов:

1. **Могу ли я по этому документу дать хотя бы одну чёткую команду агенту?**
   Если нет — документ мусорный.

2. **Каждый ли важный раздел содержит упоминание конкретных артефактов?**
   Если встречаются только абстракции — доработать.

3. **Есть ли в документе предложения, которые звучат как презентация?**
   Если да — либо удалить, либо переписать в формат «артефакт → действие → метрика».

4. **Чётко ли видно, что важнее, что вторичнее?**
   Если все пункты “просто список” без приоритета — добавить приоритет.

5. **Если дать этот документ кодовому агенту как контекст — станет ли ему понятнее, что менять в коде/конфигах?**
   Если ответ «не особо» — документ переписать.

---

## 8. Учёт контекстного окна агента

Кодовый агент имеет ограниченное контекстное окно. Длинные документы "забываются" к концу.

**Правила:**

- Документ > 500 строк — разбить на части или добавить "Table of Contents" в начало
- Критичная информация — в первых 100 строках
- Если документ длинный — добавить секцию "Quick Start" / "TL;DR" в начале
- Не дублировать информацию между документами — ссылаться

**Пример плохо:**
- SELFLEARN.md: 1000 строк, вся структура в середине

**Пример хорошо:**
- IMPACTS.md: 450 строк, сводка приоритетов в конце, но можно было вынести в начало

---

## 9. Типы документов и их форматы

Не все документы одинаковые. Разные типы — разные форматы.

| Тип | Цель | Формат | Пример |
|-----|------|--------|--------|
| **Импакт-факторы** | Что менять | Артефакт → Команда | IMPACTS.md |
| **Архитектура** | Как устроено | Компонент → Связи → Файлы | ARCHITECTURE.md |
| **Процесс** | Как работает | Этапы → Триггеры → Действия | SELFLEARN.md |
| **План** | Что делать | Шаги → Чеклисты → Критерии готовности | BACKLOG.md |
| **Статус** | Где мы сейчас | Прогресс → Текущий шаг → Блокеры | PROJECT_SNAPSHOT.md |

**Импакт-факторы:** формат этого документа (секция 4).

**Архитектура:**
- Диаграмма компонентов
- Для каждого: путь к файлам, зависимости, API

**Процесс:**
- Состояния системы
- Переходы между состояниями
- Что триггерит каждый переход

**План:**
- Шаги с номерами
- Чеклист для каждого шага
- Критерий "шаг завершён"

---

## 10. Когда документ НЕ нужен

Не создавать документ, если:

1. **Изменение в 1 файле** — сразу команда агенту, без документа
2. **Одноразовое действие** — сразу делать
3. **Информация уже есть в коде** — комментарии, README модуля, JSDoc
4. **Эксперимент** — сначала попробовать, документировать только если работает

**Плохо:**
- Создать RETRIEVAL_IMPROVEMENT.md → описать идею → дать команду агенту

**Хорошо:**
- Сразу: «В `src/agents/assembler.ts` измени `top_k` с 3 на 5, проверь метрики»

Документ нужен только когда:
- Изменение затрагивает много файлов
- Нужно зафиксировать решение для будущих сессий
- Это повторяющийся паттерн (как этот документ)

---

## 11. Anti-patterns кодового агента

Что агент делает неправильно по умолчанию (самодиагностика):

| Anti-pattern | Пример | Как исправить |
|--------------|--------|---------------|
| **Обоснования вместо инструкций** | «Это важно, потому что...» | Убрать, оставить только «Измени X на Y» |
| **Аналогии для понимания** | «Память как библиотека» | Убрать, писать техническим языком |
| **Заголовки ради структуры** | ### 1.2.3.4. Подподраздел | Плоская структура, max 2 уровня |
| **Дублирование между документами** | Одно и то же в SELFLEARN и IMPACTS | Ссылка на source of truth |
| **Избыточные примеры** | 5 примеров одного и того же | 1-2 примера достаточно |
| **Пустые секции** | «## Будущие улучшения \n TBD» | Не создавать пока нет контента |

Если замечаешь эти паттерны в моём тексте — указывай явно: «Это anti-pattern X, переделай».

---

## 12. Ссылки на артефакты

**Всегда указывать путь от корня проекта:**

- ✅ `src/agents/archivist.ts`
- ✅ `config/retrieval.json`
- ❌ `archivist.ts`
- ❌ «в конфиге retrieval»

**Если файл ещё не существует:**

- `[NEW] config/retrieval.json` — будет создан
- `[TODO] src/utils/scoring.ts` — планируется

**Если путь неточный (агент должен найти):**

- `[FIND] **/retrieval*.ts` — найти по паттерну
- `[FIND] файл с функцией calculateScore` — найти по содержимому

---

## 13. Связи между документами

**Source of Truth:**

| Тема | Источник | Остальные ссылаются |
|------|----------|---------------------|
| Импакт-факторы | IMPACTS.md | SELFLEARN.md, BACKLOG.md |
| Архитектура | ARCHITECTURE.md | Все |
| Текущий статус | PROJECT_SNAPSHOT.md | CLAUDE.md |
| План разработки | BACKLOG.md | PROJECT_SNAPSHOT.md |

**Правило:** Не дублировать. Если информация есть в source of truth — ссылаться:

```markdown
> Детали см. в [IMPACTS.md](./IMPACTS.md), секция 2.
```

**Не делать:**
```markdown
## Импакт-факторы
1. Retrieval Strategy — определяет...
2. Keyword Extraction — управляет...
(копия из IMPACTS.md)
```

