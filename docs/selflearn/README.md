# Self-Learning System

> Система непрерывного самообучения MaaS через эксперименты с импакт-факторами.

---

## Философия

> Основная цель системы — постоянное самообучение.
> Реальные диалоги с пользователем — лишь разновидность учебных кейсов.

Всё основано на прозрачных метриках: любое решение можно объяснить, повторить и откатить.

---

## Компоненты системы

| Компонент | Документ | Что делает | LLM? |
|-----------|----------|------------|------|
| **Мета-пользователь** | — | Владелец системы, задаёт цели | Человек |
| **User Emulator** | [USER EMULATOR.md](./USER%20EMULATOR.md) | Генерация диалогов через MaaS | LLM |
| **Sensor** | — | Читает из MaaS, пишет в `sensor_events` | Код |
| **Teacher** | [TEACHER.md](./TEACHER.md) | Расчёт метрик, LLM-judge, эксперименты | LLM + SQL |
| **Tuner** | [TUNER.md](./TUNER.md) | Версионирование параметров, rollback | Код |
| **Manager** | [MANAGER.md](./MANAGER.md) | Координация циклов, отчёты | LLM + код |
| **MaaS (Ученик)** | — | Предмет экспериментов | LLM |

**Подробная схема взаимодействия:** [Системы и ролей.md](./Системы%20и%20ролей.md)

---

## Цикл обучения

```
┌────────────────────────────────────────────────────────────────────┐
│                        LEARNING CYCLE                              │
│                                                                    │
│  Мета-пользователь ──цели──► Manager ──отчёты──► Мета-пользователь │
│                                 │                                  │
│                    ┌────────────┼────────────┐                     │
│                    ▼            ▼            ▼                     │
│               ┌────────┐  ┌─────────┐  ┌────────┐                  │
│               │Teacher │  │Emulator │  │ Tuner  │                  │
│               └───┬────┘  └────┬────┘  └───┬────┘                  │
│                   │            │           │                       │
│   sensor_events ◄─┤            │           ├─► experiment_params   │
│         ▲         │            ▼           │          │            │
│         │         │     ┌───────────┐      │          │            │
│      Sensor ◄─────┴─────│   MaaS    │◄─────┴──────────┘            │
│         │               │ (Ученик)  │                              │
│         │               └───────────┘                              │
│         │                     │                                    │
│         └─────── читает ──────┘                                    │
│                (pipeline_runs, raw_logs)                           │
└────────────────────────────────────────────────────────────────────┘
```

### Шаги цикла

| Шаг | Что происходит |
|-----|----------------|
| 1 | Мета-пользователь → Manager: цели и ограничения |
| 2 | Manager → Teacher: запрос на дизайн эксперимента |
| 3 | Teacher → Tuner: подготовка вариантов параметров |
| 4 | Emulator → MaaS: генерация диалогов |
| 5 | Sensor ← MaaS: съём данных в `sensor_events` |
| 6 | Teacher: анализ метрик, verdict |
| 7 | Teacher → Tuner: применение или откат |
| 8 | Manager → Мета-пользователь: отчёт |

---

## Артефакты

| Артефакт | Тип | Кто использует |
|----------|-----|----------------|
| `sensor_events` | Таблица БД | Sensor пишет, Teacher читает |
| `experiment_parameters` | Таблица БД | Tuner пишет, MaaS читает |
| `sim_scenarios.json` | Конфиг | User Emulator |
| `sim_personas.json` | Конфиг | User Emulator |

---

## Тематические документы

### Роли (кто что делает)

| Файл | Отвечает на вопрос |
|------|-------------------|
| [Системы и ролей.md](./Системы%20и%20ролей.md) | Обзор всех ролей и их взаимодействия |
| [MANAGER.md](./MANAGER.md) | Как работает координатор |
| [TEACHER.md](./TEACHER.md) | Как оценивать качество и формировать гипотезы |
| [TUNER.md](./TUNER.md) | Как безопасно менять параметры |
| [USER EMULATOR.md](./USER%20EMULATOR.md) | Как генерировать реалистичные диалоги |

### Механизмы (как это работает)

| Файл | Отвечает на вопрос |
|------|-------------------|
| [CYCLES.md](./CYCLES.md) | **Когда** запускать обучение (micro/macro/deep) |
| [EXPERIMENTS.md](./EXPERIMENTS.md) | **Как** проводить A/B тесты |
| [AUTONOMY.md](./AUTONOMY.md) | **Что** можно менять автоматически vs вручную |
| [GOLDEN_DATASET.md](./GOLDEN_DATASET.md) | **Чем** тестировать (golden dataset, LLM-judge) |

---

## Интерфейс между MaaS и Self-Learning

Self-Learning взаимодействует с MaaS через две точки:

| Файл | Определяет | Компонент | Направление |
|------|------------|-----------|-------------|
| [METRICS.md](../../METRICS.md) | Что наблюдаем (latency, precision, recall...) | Sensor читает | MaaS → Self-Learning |
| [IMPACTS.md](../../IMPACTS.md) | Что меняем (top_k, temperature, prompts...) | Tuner пишет | Self-Learning → MaaS |

```
MaaS (pipeline_runs, raw_logs, lsm_storage)
        │                           ▲
        │ Sensor читает             │ Tuner пишет
        ▼                           │
   sensor_events              experiment_parameters
        │                           ▲
        └───────► Teacher ──────────┘
                 (анализ → рекомендации)
```

---

## Связь с другими документами

| Документ | Отвечает на вопрос |
|----------|-------------------|
| [METRICS.md](../../METRICS.md) | **Что** Sensor читает из MaaS |
| [IMPACTS.md](../../IMPACTS.md) | **Что** Tuner пишет в MaaS |
| **docs/selflearn/** | **Когда, кто и как** меняет параметры |

---

## Реализация (шаги)

| Шаг | Компонент | Что делает | Статус |
|-----|-----------|------------|--------|
| 12 | User Emulator | Генерация диалогов через MaaS | [ ] |
| 13 | Sensor | Съём данных из MaaS в `sensor_events` | [ ] |
| 14 | Teacher | Расчёт метрик, LLM-judge, эксперименты | [ ] |
| 15 | Tuner | Версионирование параметров, rollback | [ ] |
| 16 | Manager | Циклы, цели, отчёты, API | [ ] |

**Детали:** см. [ROADMAP.md](../../ROADMAP.md)

---

*Последнее обновление: 2025-11-26*
