# Self-Learning System

> Система непрерывного самообучения MaaS через эксперименты с импакт-факторами.

---

## Философия

> Основная цель системы — постоянное самообучение.
> Реальные диалоги с пользователем — лишь разновидность учебных кейсов.

Всё основано на прозрачных метриках: любое решение можно объяснить, повторить и откатить.

---

## Компоненты системы

| Компонент | Документ | Что делает | LLM? |
|-----------|----------|------------|------|
| **Мета-пользователь** | — | Владелец системы, задаёт цели | Человек |
| **Manager** | [MANAGER.md](./MANAGER.md) | Мета-агент, координация проекта обучения | LLM + код |
| **User Emulator** | [USER EMULATOR.md](./USER%20EMULATOR.md) | Генерация диалогов (Student ↔ Teacher agents) | LLM |
| **Sensor** | — | Читает из MaaS, пишет в `sensor_events` | Код |
| **Analyst** | [ANALYST.md](./ANALYST.md) | "Что не так?" — метрики, verdict, диагноз | LLM + SQL |
| **Teacher** | [TEACHER.md](./TEACHER.md) | "Как исправить?" — гипотезы, новые импакты | LLM |
| **Tuner** | [TUNER.md](./TUNER.md) | Версионирование параметров, rollback | Код |
| **MaaS (Ученик)** | — | Предмет экспериментов | LLM |

### Разделение Analyst / Teacher

| Аспект | Analyst | Teacher |
|--------|---------|---------|
| **Вопрос** | "Что не так?" | "Как исправить?" |
| **Вход** | sensor_events | verdict от Analyst |
| **Выход** | verdict, diagnosis | hypothesis, change_request |
| **Знания** | Формулы метрик | Связи метрика↔импакт |

**Подробная схема взаимодействия:** [Системы и ролей.md](./Системы%20и%20ролей.md)

---

## Цикл обучения

```
┌─────────────────────────────────────────────────────────────────────────┐
│                          LEARNING CYCLE                                  │
│                                                                          │
│  Мета-пользователь ──цели──► MANAGER ──отчёты──► Мета-пользователь      │
│                                  │                                       │
│                    ┌─────────────┼─────────────┐                         │
│                    ▼             ▼             ▼                         │
│             ┌──────────┐  ┌──────────┐  ┌──────────┐                     │
│             │ Emulator │  │ Analyst  │  │ Teacher  │                     │
│             └────┬─────┘  └────┬─────┘  └────┬─────┘                     │
│                  │             │             │                           │
│                  │             │             ▼                           │
│                  │             │       ┌──────────┐                      │
│                  │             │       │  Tuner   │                      │
│                  │             │       └────┬─────┘                      │
│                  │             │            │                            │
│                  ▼             │            ▼                            │
│           ┌───────────┐        │     impact_values                       │
│           │   MaaS    │◄───────┴────────────┘                            │
│           │ (Ученик)  │                                                  │
│           └─────┬─────┘                                                  │
│                 │                                                        │
│                 ▼                                                        │
│           ┌───────────┐                                                  │
│           │  Sensor   │──────► sensor_events ──────► Analyst             │
│           └───────────┘                                                  │
│                                                                          │
└─────────────────────────────────────────────────────────────────────────┘
```

### Шаги цикла

| Шаг | Что происходит |
|-----|----------------|
| 1 | Мета-пользователь → Manager: цели, targets, ограничения |
| 2 | Manager → Emulator: запуск эмуляции (N диалогов) |
| 3 | Emulator → MaaS: Student ↔ Teacher agents диалогируют |
| 4 | Sensor ← MaaS: съём данных в `sensor_events` |
| 5 | Manager → Analyst: запрос анализа |
| 6 | **Analyst**: вычисление метрик, сравнение с targets, verdict |
| 7 | Analyst → Teacher: verdict с диагнозом |
| 8 | **Teacher**: генерация гипотезы, change_request |
| 9 | Teacher → Tuner: применение изменений (с валидацией на Golden) |
| 10 | Manager: проверка критерия остановки → goto 2 или завершение |

---

## Артефакты

| Артефакт | Тип | Кто использует |
|----------|-----|----------------|
| `sensor_events` | Таблица БД | Sensor пишет, Analyst читает |
| `analysis_verdicts` | Таблица БД | Analyst пишет, Teacher читает |
| `hypothesis_history` | Таблица БД | Teacher пишет/читает |
| `impact_values` | Таблица БД | Tuner пишет, MaaS читает |
| `parameter_history` | Таблица БД | Tuner пишет, Teacher читает |
| scenarios/ | Файлы | User Emulator (train/validation/golden) |

---

## Тематические документы

### Роли (кто что делает)

| Файл | Отвечает на вопрос |
|------|-------------------|
| [Системы и ролей.md](./Системы%20и%20ролей.md) | Обзор всех ролей и их взаимодействия |
| [MANAGER.md](./MANAGER.md) | Мета-агент: как управляет проектом обучения |
| [ANALYST.md](./ANALYST.md) | "Что не так?" — метрики, verdict, диагноз |
| [TEACHER.md](./TEACHER.md) | "Как исправить?" — гипотезы, новые импакты |
| [TUNER.md](./TUNER.md) | Как безопасно менять параметры |
| [USER EMULATOR.md](./USER%20EMULATOR.md) | Как генерировать goal-oriented диалоги |

### Механизмы (как это работает)

| Файл | Отвечает на вопрос |
|------|-------------------|
| [CYCLES.md](./CYCLES.md) | **Когда** запускать обучение (micro/macro/deep) |
| [EXPERIMENTS.md](./EXPERIMENTS.md) | **Как** проводить A/B тесты |
| [AUTONOMY.md](./AUTONOMY.md) | **Что** можно менять автоматически vs вручную |
| [GOLDEN_DATASET.md](./GOLDEN_DATASET.md) | **Чем** тестировать (golden dataset, LLM-judge) |

---

## Интерфейс между MaaS и Self-Learning

Self-Learning взаимодействует с MaaS через две точки:

| Файл | Определяет | Компонент | Направление |
|------|------------|-----------|-------------|
| [METRICS.md](../../METRICS.md) | Что наблюдаем (latency, precision, recall...) | Sensor читает | MaaS → Self-Learning |
| [IMPACTS.md](../../IMPACTS.md) | Что меняем (top_k, temperature, prompts...) | Tuner пишет | Self-Learning → MaaS |

```
MaaS (pipeline_runs, raw_logs, lsm_storage)
        │                           ▲
        │ Sensor читает             │ Tuner пишет
        ▼                           │
   sensor_events               impact_values
        │                           ▲
        ▼                           │
    ANALYST ─────► verdict ─────► TEACHER
   (метрики)                    (гипотезы)
```

---

## Связь с другими документами

| Документ | Отвечает на вопрос |
|----------|-------------------|
| [METRICS.md](../../METRICS.md) | **Что** Sensor читает из MaaS |
| [IMPACTS.md](../../IMPACTS.md) | **Что** Tuner пишет в MaaS |
| **docs/selflearn/** | **Когда, кто и как** меняет параметры |

---

## Реализация (шаги)

| Шаг | Компонент | Что делает | Статус |
|-----|-----------|------------|--------|
| 12 | User Emulator | Генерация диалогов через MaaS | [ ] |
| 13 | Sensor | Съём данных из MaaS в `sensor_events` | [ ] |
| 14 | Teacher | Расчёт метрик, LLM-judge, эксперименты | [ ] |
| 15 | Tuner | Версионирование параметров, rollback | [ ] |
| 16 | Manager | Циклы, цели, отчёты, API | [ ] |

**Детали:** см. [ROADMAP.md](../../ROADMAP.md)

---

*Последнее обновление: 2025-11-26*
