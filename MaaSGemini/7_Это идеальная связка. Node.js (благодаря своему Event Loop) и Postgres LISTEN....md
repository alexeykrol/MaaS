–≠—Ç–æ **–∏–¥–µ–∞–ª—å–Ω–∞—è —Å–≤—è–∑–∫–∞**. Node.js (–±–ª–∞–≥–æ–¥–∞—Ä—è —Å–≤–æ–µ–º—É Event Loop) –∏ Postgres LISTEN/NOTIFY —Å–æ–∑–¥–∞–Ω—ã –¥—Ä—É–≥ –¥–ª—è –¥—Ä—É–≥–∞. –í –æ—Ç–ª–∏—á–∏–µ –æ—Ç Python, –≥–¥–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å –∏–Ω–æ–≥–¥–∞ —Ç—Ä–µ–±—É–µ—Ç "—Ç–∞–Ω—Ü–µ–≤ —Å –±—É–±–Ω–æ–º", –≤ Node.js —ç—Ç–æ –Ω–∞—Ç–∏–≤–Ω–∞—è —Å—Ä–µ–¥–∞.

–í–æ—Ç **–≥–æ—Ç–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏** –¥–ª—è —Å—Ç–µ–∫–∞ TypeScript + pg (node-postgres). –≠—Ç–æ —Ç–æ—Ç —Å–∞–º—ã–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç –¥–ª—è –≤–∞—à–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã —Å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏ –º–æ–¥—É–ª—è–º–∏.

### –®–∞–≥ 1. SQL (–ù–∞—Å—Ç—Ä–æ–π–∫–∞ "–ù–µ—Ä–≤–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã")

–í –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —Å–æ–∑–¥–∞–µ–º –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –∫—Ä–∏—á–∞—Ç—å "–≠–π, —Ç—É—Ç —Ä–∞–±–æ—Ç–∞!" –ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏.

SQL

-- 1. –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ

CREATE OR REPLACE FUNCTION notify\_pipeline\_change()

RETURNS trigger AS $$

BEGIN

-- –ú—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –∫–∞–Ω–∞–ª 'pipeline\_events' JSON —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–æ–π

PERFORM pg\_notify(

'pipeline\_events', 

json\_build\_object(

'id', NEW.id, 

'status', NEW.status, 

'operation', TG\_OP -- 'INSERT' –∏–ª–∏ 'UPDATE'

)::text

);

RETURN NEW;

END;

$$ LANGUAGE plpgsql;

-- 2. –¢—Ä–∏–≥–≥–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏

CREATE TRIGGER on\_pipeline\_change

AFTER INSERT OR UPDATE ON pipeline\_runs

FOR EACH ROW

EXECUTE FUNCTION notify\_pipeline\_change();

### –®–∞–≥ 2. TypeScript (–í–æ—Ä–∫–µ—Ä-–°–ª—É—à–∞—Ç–µ–ª—å)

–í–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –ø–∞–∫–µ—Ç pg: npm install pg @types/pg.

–í–æ—Ç —à–∞–±–ª–æ–Ω –≤–∞—à–µ–≥–æ **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞**, –∫–æ—Ç–æ—Ä—ã–π —Å–ª—É—à–∞–µ—Ç –±–∞–∑—É –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –Ω—É–∂–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤:

TypeScript

import \{ Client, Notification \} from 'pg';

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

const dbConfig = \{

connectionString: process.env.DATABASE\_URL, 

\};

// –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å–æ–±—ã—Ç–∏—è –∏–∑ –±–∞–∑—ã

interface PipelineEvent \{

id: string;

status: string; // 'NEW' \| 'ANALYZED' \| 'CONTEXT\_READY'

operation: 'INSERT' \| 'UPDATE';

\}

async function startListener() \{

const client = new Client(dbConfig);

  

try \{

await client.connect();

    

// 1. –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ–º—Å—è –Ω–∞ –∫–∞–Ω–∞–ª

await client.query('LISTEN pipeline\_events');

console.log('üì° Listening for pipeline events...');

// 2. –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π (–≠—Ç–æ —Å–µ—Ä–¥—Ü–µ —Å–∏—Å—Ç–µ–º—ã)

client.on('notification', async (msg: Notification) =\> \{

if (!msg.payload) return;

const event: PipelineEvent = JSON.parse(msg.payload);

console.log(\`üîî Event received: Status \[$\{event.status\}\] for ID \[$\{event.id\}\]\`);

// –ú–ê–†–®–†–£–¢–ò–ó–ê–¶–ò–Ø –ó–ê–î–ê–ß (–¢–æ—Ç —Å–∞–º—ã–π Dispatcher)

switch (event.status) \{

case 'NEW':

// –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞ (–ü–æ–∏—Å–∫–æ–≤–∏–∫–∞)

await runAnalyzerAgent(event.id); 

break;

case 'ANALYZED':

// –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –°–±–æ—Ä—â–∏–∫–∞ (–°–æ–∑–¥–∞—Ç–µ–ª—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞)

await runAssemblerAgent(event.id);

break;

case 'CONTEXT\_READY':

// –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –§–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–∏

await runFinalModelAgent(event.id);

break;

          

default:

// –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä, PROCESSING)

break;

\}

\});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ–±—Ä—ã–≤–∞ —Å–≤—è–∑–∏ (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞!)

client.on('error', (err) =\> \{

console.error('DB connection lost', err);

// –¢—É—Ç –Ω—É–∂–Ω–∞ –ª–æ–≥–∏–∫–∞ —Ä–µ–∫–æ–Ω–Ω–µ–∫—Ç–∞

\});

\} catch (err) \{

console.error('Failed to connect', err);

\}

\}

// --- –ó–∞–≥–ª—É—à–∫–∏ –¥–ª—è –≤–∞—à–∏—Ö –ê–≥–µ–Ω—Ç–æ–≤ ---

async function runAnalyzerAgent(runId: string) \{

console.log(\`üïµÔ∏è‚Äç‚ôÇÔ∏è –ó–∞–ø—É—Å–∫–∞—é –ê–ù–ê–õ–ò–ó–ê–¢–û–†–ê –¥–ª—è $\{runId\}...\`);

  

// –í–ê–ñ–ù–û: –ü–∞—Ç—Ç–µ—Ä–Ω "–ó–∞—Ö–≤–∞—Ç –∑–∞–¥–∞—á–∏" (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –≥–æ–Ω–∫–∏, –µ—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä–æ–≤ –Ω–µ—Å–∫–æ–ª—å–∫–æ)

// UPDATE pipeline\_runs SET status = 'ANALYZING' WHERE id = runId AND status = 'NEW';

// –ï—Å–ª–∏ update –≤–µ—Ä–Ω—É–ª 0 —Å—Ç—Ä–æ–∫ ‚Äî –∑–Ω–∞—á–∏—Ç –∫—Ç–æ-—Ç–æ —É–∂–µ –≤–∑—è–ª –∑–∞–¥–∞—á—É.

  

// ... —Ç—É—Ç –≤–∞—à –∫–æ–¥ –≤—ã–∑–æ–≤–∞ LLM Router ...

// ... –ø–æ –∏—Ç–æ–≥—É: UPDATE pipeline\_runs SET status = 'ANALYZED', analysis\_result = ...

\}

async function runAssemblerAgent(runId: string) \{

console.log(\`üèóÔ∏è –ó–∞–ø—É—Å–∫–∞—é –°–ë–û–†–©–ò–ö–ê –¥–ª—è $\{runId\}...\`);

// ... –ª–æ–≥–∏–∫–∞ —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ ...

\}

async function runFinalModelAgent(runId: string) \{

console.log(\`ü§ñ –ó–∞–ø—É—Å–∫–∞—é –û–¢–í–ï–ß–ê–Æ–©–£–Æ –ú–û–î–ï–õ–¨ –¥–ª—è $\{runId\}...\`);

// ... –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞ ...

\}

// –ó–∞–ø—É—Å–∫

startListener();

### –ü–æ—á–µ–º—É —ç—Ç–æ –∫—Ä—É—Ç–æ –¥–ª—è Node.js:

1. **Zero Polling:** –í–∞—à —Å–∫—Ä–∏–ø—Ç –Ω–µ –¥–æ–ª–±–∏—Ç –±–∞–∑—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ SELECT * .... –û–Ω –ø—Ä–æ—Å—Ç–æ "—Å–ø–∏—Ç" –∏ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç 0 —Ä–µ—Å—É—Ä—Å–æ–≤ CPU, –ø–æ–∫–∞ Postgres –Ω–µ –ø–∏—Ö–Ω–µ—Ç –µ–≥–æ –≤ –±–æ–∫.
2. **–†–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å:** –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø–∏—Å—å—é –≤ –±–∞–∑—É –∏ –∑–∞–ø—É—Å–∫–æ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Node.js ‚Äî –±—É–∫–≤–∞–ª—å–Ω–æ 1-2 –º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã.
3. **–ü—Ä–æ—Å—Ç–æ—Ç–∞ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è:** –í—ã –º–æ–∂–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç—å —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –≤ 3-—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–∞—Ö. Postgres —Ä–∞–∑–æ—à–ª–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º. –í–∞–º –ø—Ä–æ—Å—Ç–æ –Ω—É–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –º–∞–ª–µ–Ω—å–∫—É—é –ø—Ä–æ–≤–µ—Ä–∫—É (–∫–∞–∫ –Ω–∞–ø–∏—Å–∞–Ω–æ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ runAnalyzerAgent), —á—Ç–æ–±—ã –∑–∞–¥–∞—á—É –≤–∑—è–ª —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤—ã–π —É—Å–ø–µ–≤—à–∏–π.

**–ê–ª–µ–∫—Å–µ–π, —É –≤–∞—Å —Ç–µ–ø–µ—Ä—å –µ—Å—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Ç:**

1. –ö–æ–Ω—Ü–µ–ø—Ç—É–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–°—É–±-–∞–≥–µ–Ω—Ç—ã + –ü–∞–º—è—Ç—å).
2. –õ–æ–≥–∏—á–µ—Å–∫–∞—è —Å—Ö–µ–º–∞ –ø–æ—Ç–æ–∫–æ–≤ (—Ä–æ–∑–æ–≤–∞—è –¥–∏–∞–≥—Ä–∞–º–º–∞).
3. –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (3 —Ç–∞–±–ª–∏—Ü—ã).
4. –ö–æ–¥ —è–¥—Ä–∞ –Ω–∞ TypeScript –¥–ª—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏.

**–ö–∞–∫–æ–π —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥?** –ë—É–¥–µ–º –ø–∏—Å–∞—Ç—å –ø—Ä–æ–º–ø—Ç –¥–ª—è **–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞** (—á—Ç–æ–±—ã –≤—Å—Ç–∞–≤–∏—Ç—å –µ–≥–æ –≤ —Ñ—É–Ω–∫—Ü–∏—é runAnalyzerAgent) –∏–ª–∏ —Ö–æ—Ç–∏—Ç–µ —É—Ç–æ—á–Ω–∏—Ç—å –¥–µ—Ç–∞–ª–∏ –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ë–î?

